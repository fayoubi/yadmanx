{
	"info": {
		"_postman_id": "yadmanx-agent-service-collection",
		"name": "YadmanX Agent Service API",
		"description": "Complete API collection for the YadmanX Agent Service with OTP authentication and enrollment management",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Service Info",
			"item": [
				{
					"name": "Root - Service Info",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/",
							"host": ["{{baseUrl}}"],
							"path": [""]
						},
						"description": "Get basic service information"
					}
				},
				{
					"name": "Health Check",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/v1/health",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "health"]
						},
						"description": "Check service health and database connection"
					}
				},
				{
					"name": "API Documentation",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl}}/api/docs/",
							"host": ["{{baseUrl}}"],
							"path": ["api", "docs", ""]
						},
						"description": "View HTML API documentation"
					}
				}
			]
		},
		{
			"name": "Authentication",
			"item": [
				{
					"name": "1. Register Agent",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.otp && response.data.otp.code) {",
									"        pm.environment.set('otpCode', response.data.otp.code);",
									"        console.log('OTP Code saved:', response.data.otp.code);",
									"    }",
									"    if (response.data && response.data.agent && response.data.agent.phone_number) {",
									"        pm.environment.set('phoneNumber', response.data.agent.phone_number);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"Ahmed\",\n  \"last_name\": \"Bennani\",\n  \"email\": \"ahmed.bennani@example.com\",\n  \"country_code\": \"+212\",\n  \"phone_number\": \"612345678\",\n  \"agency_name\": \"Agence Atlas Assurance\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/register",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "register"]
						},
						"description": "Register a new agent. Returns OTP code in development mode."
					}
				},
				{
					"name": "2. Request OTP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.otp && response.data.otp.code) {",
									"        pm.environment.set('otpCode', response.data.otp.code);",
									"        console.log('OTP Code saved:', response.data.otp.code);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"phone_number\": \"612345678\",\n  \"country_code\": \"+212\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/request-otp",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "request-otp"]
						},
						"description": "Request an OTP for phone authentication. Code is valid for 10 minutes."
					}
				},
				{
					"name": "3. Verify OTP",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 200) {",
									"    const response = pm.response.json();",
									"    if (response.token) {",
									"        pm.environment.set('accessToken', response.token);",
									"        console.log('Access token saved');",
									"    }",
									"    if (response.agent && response.agent.id) {",
									"        pm.environment.set('agentId', response.agent.id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"phone_number\": \"{{phoneNumber}}\",\n  \"code\": \"{{otpCode}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/verify-otp",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "verify-otp"]
						},
						"description": "Verify OTP code and receive JWT access token"
					}
				},
				{
					"name": "Validate Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\": \"{{accessToken}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/validate",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "validate"]
						},
						"description": "Validate a JWT token (for inter-service communication)"
					}
				},
				{
					"name": "Refresh Token",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/refresh",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "refresh"]
						},
						"description": "Refresh an expired access token"
					}
				},
				{
					"name": "Logout",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/auth/logout",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "auth", "logout"]
						},
						"description": "Invalidate current session and logout"
					}
				}
			]
		},
		{
			"name": "Agent Profile",
			"item": [
				{
					"name": "Get My Profile",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/agents/me",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "agents", "me"]
						},
						"description": "Get authenticated agent's profile information"
					}
				},
				{
					"name": "Update My Profile",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"first_name\": \"Ahmed\",\n  \"last_name\": \"El Bennani\",\n  \"email\": \"ahmed.elbennani@example.com\"\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/agents/me",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "agents", "me"]
						},
						"description": "Update authenticated agent's profile"
					}
				}
			]
		},
		{
			"name": "Enrollments",
			"item": [
				{
					"name": "Get All Enrollments",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/agents/enrollments",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "agents", "enrollments"]
						},
						"description": "Get all enrollments created by the authenticated agent"
					}
				},
				{
					"name": "Get Enrollment by ID",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							}
						],
						"url": {
							"raw": "{{baseUrl}}/api/v1/agents/enrollments/{{enrollmentId}}",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "agents", "enrollments", "{{enrollmentId}}"]
						},
						"description": "Get detailed information about a specific enrollment"
					}
				},
				{
					"name": "Create Enrollment",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"if (pm.response.code === 201) {",
									"    const response = pm.response.json();",
									"    if (response.data && response.data.enrollment_id) {",
									"        pm.environment.set('enrollmentId', response.data.enrollment_id);",
									"        console.log('Enrollment ID saved:', response.data.enrollment_id);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{accessToken}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"customer\": {\n    \"first_name\": \"Mohammed\",\n    \"last_name\": \"Hassan\",\n    \"email\": \"mohammed.hassan@example.com\",\n    \"phone\": \"+212623456789\",\n    \"date_of_birth\": \"1990-05-15\",\n    \"cin\": \"AB123456\",\n    \"address\": {\n      \"street\": \"123 Rue Mohammed V\",\n      \"city\": \"Casablanca\",\n      \"country\": \"Morocco\",\n      \"postal_code\": \"20000\"\n    }\n  },\n  \"policy_type\": \"term_life\",\n  \"coverage_amount\": \"500000\",\n  \"billing\": {\n    \"contribution_amount\": \"500\",\n    \"contribution_frequency\": \"monthly\",\n    \"payment_method_type\": \"bank_draft\",\n    \"effective_date\": \"2025-10-01\"\n  },\n  \"beneficiaries\": [\n    {\n      \"first_name\": \"Fatima\",\n      \"last_name\": \"Hassan\",\n      \"relationship\": \"spouse\",\n      \"percentage\": 100,\n      \"date_of_birth\": \"1992-03-20\"\n    }\n  ]\n}"
						},
						"url": {
							"raw": "{{baseUrl}}/api/v1/agents/enrollments",
							"host": ["{{baseUrl}}"],
							"path": ["api", "v1", "agents", "enrollments"]
						},
						"description": "Create a new enrollment for a customer"
					}
				}
			]
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:3003",
			"type": "string"
		},
		{
			"key": "accessToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "refreshToken",
			"value": "",
			"type": "string"
		},
		{
			"key": "otpCode",
			"value": "",
			"type": "string"
		},
		{
			"key": "phoneNumber",
			"value": "612345678",
			"type": "string"
		},
		{
			"key": "agentId",
			"value": "",
			"type": "string"
		},
		{
			"key": "enrollmentId",
			"value": "",
			"type": "string"
		}
	]
}
